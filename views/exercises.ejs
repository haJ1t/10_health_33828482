<%- include('partials/header') %>
<%- include('partials/nav') %>

<main class="main-content">
    <section class="exercises-section">
        <div class="page-header">
            <h1><i class="fas fa-dumbbell"></i> My Exercises</h1>
            <div class="header-actions">
                <a href="<%= basePath %>/exercises/add" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add Exercise
                </a>
                <a href="<%= basePath %>/exercises/search" class="btn btn-secondary">
                    <i class="fas fa-search"></i> Search
                </a>
            </div>
        </div>
        
        <% if (error) { %>
            <div class="alert alert-error">
                <i class="fas fa-exclamation-circle"></i>
                <%= error %>
            </div>
        <% } %>
        
        <% if (exercises && exercises.length > 0) { %>
            <!-- Exercise Statistics -->
            <div class="exercise-stats">
                <h2>Statistics</h2>
                <canvas id="exerciseChart" width="400" height="200"></canvas>
            </div>
            
            <!-- Exercise List -->
            <div class="exercises-list">
                <h2>All Exercises (<%= exercises.length %>)</h2>
                
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Exercise</th>
                                <th>Type</th>
                                <th>Duration</th>
                                <th>Calories</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% exercises.forEach(exercise => { %>
                                <tr>
                                    <td><%= new Date(exercise.date).toLocaleDateString() %></td>
                                    <td><strong><%= exercise.exercise_name %></strong></td>
                                    <td>
                                        <span class="badge badge-<%= exercise.exercise_type %>">
                                            <%= exercise.exercise_type %>
                                        </span>
                                    </td>
                                    <td><%= exercise.duration_minutes %> min</td>
                                    <td>
                                        <span class="calories">
                                            <i class="fas fa-fire"></i>
                                            <%= exercise.calories_burned || 'N/A' %>
                                        </span>
                                    </td>
                                    <td class="notes-cell">
                                        <%= exercise.notes || '-' %>
                                    </td>
                                    <td>
                                        <form action="<%= basePath %>/exercises/delete/<%= exercise.id %>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this exercise?');">
                                            <button type="submit" class="btn btn-danger btn-sm">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Chart.js Script for visualization (Advanced Feature) -->
            <script>
                // Prepare data for chart
                const exerciseData = <%- JSON.stringify(exercises) %>;
                
                // Group by type
                const typeCount = {};
                const typeCalories = {};
                
                exerciseData.forEach(ex => {
                    const type = ex.exercise_type;
                    typeCount[type] = (typeCount[type] || 0) + 1;
                    typeCalories[type] = (typeCalories[type] || 0) + (ex.calories_burned || 0);
                });
                
                // Create chart
                const ctx = document.getElementById('exerciseChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(typeCount),
                        datasets: [{
                            label: 'Number of Exercises',
                            data: Object.values(typeCount),
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }, {
                            label: 'Total Calories Burned',
                            data: Object.values(typeCalories),
                            backgroundColor: 'rgba(255, 99, 132, 0.6)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            </script>
        <% } else { %>
            <div class="empty-state">
                <i class="fas fa-dumbbell empty-icon"></i>
                <h2>No exercises yet</h2>
                <p>Start tracking your workouts by adding your first exercise!</p>
                <a href="<%= basePath %>/exercises/add" class="btn btn-primary btn-large">
                    <i class="fas fa-plus"></i> Add Your First Exercise
                </a>
            </div>
        <% } %>
    </section>
</main>

<%- include('partials/footer') %>
